<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grade 10 Nature's Spring - Manito & Manita</title>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getDatabase, ref, push, onValue, update, get } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyD52hVtU6Jr48S0TNRrgpgsbtsdxy1BP5U",
    authDomain: "natures-spring-f1241.firebaseapp.com",
    databaseURL: "https://natures-spring-f1241-default-rtdb.firebaseio.com",
    projectId: "natures-spring-f1241",
    storageBucket: "natures-spring-f1241.appspot.com",
    messagingSenderId: "1032574991274",
    appId: "1:1032574991274:web:b870cfd7f166cfa312c9d3"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  // Predefined names
  const predefinedNames = [
    "aboyo","montebano","magallanes","maru","clarido",
    "olvido","de los reyes","panaligan","alon","ma'am thess"
  ];

  // Initialize predefined names in database if not exists
  const namesRef = ref(database, 'names');
  get(namesRef).then(snapshot => {
    const allNames = snapshot.val() || {};
    predefinedNames.forEach(n => {
      if(!allNames[n]) {
        update(ref(database, 'names/' + n), { picked: false, pickedBy: "" });
      }
    });
  });

  // Enter your name
  window.enterName = function() {
    const nameInput = document.getElementById('nameInput');
    const name = nameInput.value.trim();
    if(!name) return alert("Enter your name first!");

    // Add to entered list
    const enteredRef = ref(database, 'entered');
    push(enteredRef, name);

    // Add to names pool if not exists
    const nameRef = ref(database, 'names/' + name);
    get(nameRef).then(snapshot => {
      if(!snapshot.exists()) {
        update(nameRef, { picked: false, pickedBy: "" });
      }
    });

    nameInput.value = ''; // clear input
  }

  // Listen for entered names
  const enteredDiv = document.getElementById('enteredList');
  const enteredRef = ref(database, 'entered');
  onValue(enteredRef, snapshot => {
    const data = snapshot.val() || {};
    enteredDiv.innerHTML = Object.values(data).join('<br>');
  });

  // Pick a random name
  window.pickName = function() {
    const picker = document.getElementById('nameInput').value.trim();
    if(!picker) return alert("Enter your name first to pick someone!");

    get(namesRef).then(snapshot => {
      const allNames = snapshot.val() || {};
      const available = Object.keys(allNames).filter(n => !allNames[n].picked && n !== picker);
      if(available.length === 0) return alert("All names have been picked!");

      const randomName = available[Math.floor(Math.random() * available.length)];

      // Mark as picked
      update(ref(database, 'names/' + randomName), { picked: true, pickedBy: picker });

      alert(`${picker}, you got: ${randomName}`);
    });
  }
</script>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    color: #fff;
    background: 
      linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)),
      url('natures-spring-3.png') no-repeat center center fixed;
    background-size: cover;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  h1 { margin-bottom: 20px; text-align: center; }
  input { padding: 10px; font-size: 16px; margin-right: 10px; width: 200px; }
  button { padding: 10px 20px; font-size: 16px; margin: 5px; cursor: pointer; }
  #enteredList { margin-top: 20px; font-size: 18px; text-align: center; }
</style>
</head>

<body>
<h1>Grade 10 Nature's Spring - Manito & Manita</h1>

<div>
  <input type="text" id="nameInput" placeholder="Enter your name">
  <button onclick="enterName()">Enter</button>
</div>

<div>
  <button onclick="pickName()">Pick from Jar</button>
</div>

<h3>Already Entered:</h3>
<div id="enteredList"></div>

</body>
</html>
